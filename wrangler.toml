name = "drone"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

[triggers]
crons = [
  "*/10 * * * *",     # Every 10 minutes (changed from 5 for reduced DB load)
  "*/15 * * * *",     # Every 15 minutes
  "0 */4 * * *",      # Every 4 hours - CISA KEV
  "0 3 * * *"         # Daily at 3 AM
]

[[d1_databases]]
binding = "DB"
database_name = "drone"
database_id = "3bcb5e2d-bfd6-4048-9992-d6c7807af619"

[assets]
directory = "./frontend/dist"

[vars]
ENVIRONMENT = "production"
ALERTS_ENABLED = "true"
PAGE_ROTATION_SECONDS = "45"
TICKER_REFRESH_SECONDS = "30"

[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1

# Secrets (set via: wrangler secret put SECRET_NAME)
# CF_RADAR_API_TOKEN
# TEAMS_WEBHOOK_URL
# M365_TENANT_ID
# M365_CLIENT_ID
# M365_CLIENT_SECRET
# HEALTH_RELAY_SECRET - Shared secret for GitHub Actions health relay (HMAC-SHA256)
# RANSOMWARE_API_KEY - API key for ransomware.live
